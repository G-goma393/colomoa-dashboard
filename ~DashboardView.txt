import { ItemView, WorkspaceLeaf } from "obsidian";
import { createRoot, Root } from "react-dom/client";
import * as React from "react";

// ビューを識別するためのID（定数）
export const DASHBOARD_VIEW_TYPE = "dashboard-view";

export class DashboardView extends ItemView {
	root: Root | null = null;

	constructor(leaf: WorkspaceLeaf) {
		super(leaf);
	}

	getViewType() {
		return DASHBOARD_VIEW_TYPE;
	}

	getDisplayText() {
		return "Dashboard";
	}

	async onOpen() {
		// 1. ビューのコンテナにクラスを追加（CSSで装飾するため）
		this.contentEl.addClass("dashboard-view");

		// 2. Reactのルートを作成
		this.root = createRoot(this.contentEl);

		// 3. Reactコンポーネントをマウント（注入）
		// ここではまだSwiperではなく、シンプルなh1タグを表示します
		this.root.render(
			<div className="dashboard-container">
				<h1>Hello, React & Obsidian!</h1>
				<p>This is a React component inside an Obsidian view.</p>
			</div>,
		);
	}

	async onClose() {
		// ビューが閉じられたら、Reactのマウントを解除してメモリを開放する
		this.root?.unmount();
	}
}
